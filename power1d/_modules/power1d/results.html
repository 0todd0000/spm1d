<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>power1d.results &#8212; power1d 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body role="document">
<div class="header" role="banner">
  <div class="logo">
    <a href="../../index.html">
      <img class="logo" src="../../_static/logo.png" border="0" alt="Logo"/>
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">power1d 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for power1d.results</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">A module for probing, displaying and plotting **power1d**</span>
<span class="sd">simulation results.</span>

<span class="sd">This module contains the **SimulationResults** class which</span>
<span class="sd">is meant to be instantiated only by **power1d** and not by</span>
<span class="sd">the user. However, once instantiated the user can run</span>
<span class="sd">a variety of analyses using the methods described below.</span>

<span class="sd">Importantly, since simualations can take a long time to run</span>
<span class="sd">users are encouraged to save **SimulationResults** objects</span>
<span class="sd">using the &quot;save&quot; method and re-loaded using the</span>
<span class="sd">**load_simulation_results** method of an</span>
<span class="sd">**ExperimentSimulator** object.</span>

<span class="sd">Example:</span>

<span class="sd">.. plot::</span>
<span class="sd">	:include-source:</span>

<span class="sd">	import numpy as np</span>
<span class="sd">	from matplotlib import pyplot</span>
<span class="sd">	import power1d</span>

<span class="sd">	J        = 8</span>
<span class="sd">	Q        = 101</span>
<span class="sd">	baseline = power1d.geom.Null( Q=Q )</span>
<span class="sd">	signal0  = power1d.geom.Null( Q=Q )</span>
<span class="sd">	signal1  = power1d.geom.GaussianPulse( Q=Q, q=40, fwhm=15, amp=1.0 )</span>
<span class="sd">	noise    = power1d.noise.Gaussian( J=J, Q=Q, mu=0, sigma=0.3 )</span>
<span class="sd">	model0   = power1d.models.DataSample(baseline, signal0, noise, J=J)</span>
<span class="sd">	model1   = power1d.models.DataSample(baseline, signal1, noise, J=J)</span>
<span class="sd">	</span>
<span class="sd">	emodel0  = power1d.models.Experiment( [model0, model0], fn=power1d.stats.t_2sample )</span>
<span class="sd">	emodel1  = power1d.models.Experiment( [model0, model1], fn=power1d.stats.t_2sample )</span>

<span class="sd">	sim      = power1d.models.ExperimentSimulator(emodel0, emodel1)</span>
<span class="sd">	results  = sim.simulate(iterations=200, progress_bar=True)</span>
<span class="sd">	</span>
<span class="sd">	pyplot.close(&#39;all&#39;)</span>
<span class="sd">	results.plot()</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="c1"># Copyright (C) 2017  Todd Pataky</span>
<span class="c1"># version: 0.1 (2017/04/01)</span>


<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">ndimage</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="n">roi</span> <span class="kn">import</span> <span class="nn">RegionOfInterest</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="n">_plot</span> <span class="kn">import</span> <span class="nn">_plot_results_one_datamodel</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="n">_plot</span> <span class="kn">import</span> <span class="nn">_plot_results_multiple_datamodels</span>


<span class="k">def</span> <span class="nf">_pkmax</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Compute the probability of observing a cluster with extent *k*.</span>
<span class="sd">	</span>
<span class="sd">	Z :  (nIterations x nNodes) array of test statistic continua</span>
<span class="sd">	u :  threshold (float)</span>
<span class="sd">	k :  cluster extent (int)</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">struct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span><span class="o">*</span><span class="n">k</span> <span class="p">])</span>
	<span class="n">H</span>      <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">binary_hit_or_miss</span><span class="p">(</span> <span class="n">Z</span> <span class="o">&gt;</span> <span class="n">u</span> <span class="p">,</span> <span class="n">structure1</span><span class="o">=</span><span class="n">struct</span><span class="p">)</span>
	<span class="n">p</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">p</span>



<div class="viewcode-block" id="SimulationResults"><a class="viewcode-back" href="../../API/results.html#power1d.results.SimulationResults">[docs]</a><span class="k">class</span> <span class="nc">SimulationResults</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	A class containing **power1d** simulation results</span>
<span class="sd">	including distributions and derived probabilities.</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model0</span><span class="p">,</span> <span class="n">model1</span><span class="p">,</span> <span class="n">Z0</span><span class="p">,</span> <span class="n">Z1</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
		<span class="c1">### experimental models (for plotting only)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">model0</span>        <span class="o">=</span> <span class="n">model0</span>  <span class="c1">#: the &quot;null&quot; experiment model  (an instance of **power1d.models.Experiment**)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">model1</span>        <span class="o">=</span> <span class="n">model1</span>  <span class="c1">#: the &quot;alternative&quot; experiment model   (an instance of **power1d.models.Experiment**)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">dt</span>            <span class="o">=</span> <span class="n">dt</span>      <span class="c1">#: total simulation duration (s)</span>
		<span class="c1">### simulated experimental continua (constants):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">niters</span>        <span class="o">=</span> <span class="n">Z0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#: number of simulation iterations</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Q</span>             <span class="o">=</span> <span class="n">Z0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#: continuum size</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Z0</span>            <span class="o">=</span> <span class="n">Z0</span>      <span class="c1">#: test statistic continua (&quot;null&quot; experiment)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">Z1</span>            <span class="o">=</span> <span class="n">Z1</span>      <span class="c1">#: test statistic continua (&quot;alternative&quot; experiment)</span>
		<span class="c1">#: inference parameters:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>         <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#: Type I error rate (default 0.05)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">roi</span>           <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#: region(s) of interest (default: whole continuum)</span>
		<span class="c1">### power-relevant distribution summarizers:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">zstar</span>         <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#: critical threshold for omnibus null (based on Z0max)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">z0</span>            <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#: distribution upon which omnibus H0 rejection decision is based (&quot;null&quot; model)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">z1</span>            <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#: distribution upon which omnibus H0 rejection decision is based (&quot;alternative&quot; model)</span>
		<span class="c1">### user-selected inference parameters:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">coi</span>           <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#: continuum centers-of-interest (if any) for which summary powers will be displayed when printing results</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">coir</span>          <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#: center-of-interest radius (for coi continuum, default 3)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">poi</span>           <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#: continuum points-of-interest (if any) for which summary powers will be displayed when printing results</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">k</span>             <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#: cluster extent (default 1);  clusters in the excursion set with smaller extents will be ignored when computing probabilities</span>
		<span class="c1">### probability results:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">p_reject0</span>     <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#: omnibus null rejection probability for the &quot;null&quot; experiment (alpha by defintion)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">p_reject1</span>     <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#: omnibus null rejection probability for the &quot;alternative&quot; experiment (power by defintion)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">p1d_poi0</span>      <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#: POI probability continuum for the &quot;null&quot; experiment</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">p1d_poi1</span>      <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#: POI probability continuum for the &quot;alternative&quot; experiment</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">p1d_coi0</span>      <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#: COI probability continuum for the &quot;null&quot; experiment</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">p1d_coi1</span>      <span class="o">=</span> <span class="kc">None</span>    <span class="c1">#: COI probability continuum for the &quot;alternative&quot; experiment</span>
		<span class="c1">### probability results (at user-specified POIs and COIs)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">p_poi0</span>        <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">p_poi1</span>        <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">p_coi0</span>        <span class="o">=</span> <span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">p_coi1</span>        <span class="o">=</span> <span class="kc">None</span>
		<span class="c1">### set default parameters and calculate probabilities:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>


	<span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">s</span>  <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;power1d simulation results</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Simulation overview</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;   number of iterations = </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span>  <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">niters</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;   duration             = </span><span class="si">%.2f</span><span class="s1"> s</span><span class="se">\n</span><span class="s1">&#39;</span>  <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;Main parameters</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;   alpha              = </span><span class="si">%0.5f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;   critical test stat = </span><span class="si">%.5f</span><span class="se">\n</span><span class="s1">&#39;</span>  <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">zstar</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;H0 rejection probabilities (omnibus)</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;   Null model:    p = </span><span class="si">%.5f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">p_reject0</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;   Effect model:  p = </span><span class="si">%.5f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">p_reject1</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;H0 rejection probability (COI)</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;   Position   Radius   Null model   Effect model</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">coi</span><span class="p">,</span><span class="n">r</span><span class="p">),</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_coi0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_coi1</span><span class="p">):</span>
				<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;   </span><span class="si">%s</span><span class="s1">    </span><span class="si">%s</span><span class="s1">      </span><span class="si">%0.5f</span><span class="s1">       </span><span class="si">%0.5f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">coi</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">),</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
			<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">poi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;H0 rejection probability (POI)</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;   Position     Null model    Effect model</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="k">for</span> <span class="n">poi</span><span class="p">,</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_poi0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_poi1</span><span class="p">):</span>
				<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;   </span><span class="si">%s</span><span class="s1">        </span><span class="si">%0.5f</span><span class="s1">       </span><span class="si">%0.5f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">poi</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">),</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
			<span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">return</span> <span class="n">s</span>



	
	<span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>      <span class="o">=</span> <span class="mf">0.05</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">coir</span>       <span class="o">=</span> <span class="mi">3</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">roi</span>        <span class="o">=</span> <span class="n">RegionOfInterest</span><span class="p">(</span>   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="p">)</span>   <span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">k</span>          <span class="o">=</span> <span class="mi">1</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_calculate_probabilities</span><span class="p">()</span>




	<span class="c1">#----------------------------------------</span>
	<span class="c1"># COI-level calculations</span>
	<span class="c1">#----------------------------------------</span>

	<span class="k">def</span> <span class="nf">_calculate_prob_coi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1">### P(H0 reject) at centers of interest:</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">p</span>            <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_calculate_prob_coi_single_node</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>  <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">]</span>
			<span class="n">p0</span><span class="p">,</span><span class="n">p1</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">p_coi0</span>  <span class="o">=</span> <span class="n">p0</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">p_coi1</span>  <span class="o">=</span> <span class="n">p1</span>

	<span class="k">def</span> <span class="nf">_calculate_prob_coi_single_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
		<span class="n">x0</span><span class="p">,</span><span class="n">x1</span>    <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span>
		<span class="n">x0</span><span class="p">,</span><span class="n">xa</span>    <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">p0</span>       <span class="o">=</span> <span class="n">_pkmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z0</span><span class="p">[:,</span><span class="n">x0</span><span class="p">:</span><span class="n">x1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">zstar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
			<span class="n">p1</span>       <span class="o">=</span> <span class="n">_pkmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z1</span><span class="p">[:,</span><span class="n">x0</span><span class="p">:</span><span class="n">x1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">zstar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">z0max</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z0</span><span class="p">[:,</span><span class="n">x0</span><span class="p">:</span><span class="n">x1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
			<span class="n">z1max</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z1</span><span class="p">[:,</span><span class="n">x0</span><span class="p">:</span><span class="n">x1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
			<span class="n">p0</span>       <span class="o">=</span> <span class="p">(</span><span class="n">z0max</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">zstar</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
			<span class="n">p1</span>       <span class="o">=</span> <span class="p">(</span><span class="n">z1max</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">zstar</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">p0</span><span class="p">,</span><span class="n">p1</span>

	<span class="k">def</span> <span class="nf">_calculate_prob_continua_coi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">p0</span><span class="p">,</span><span class="n">p1</span>            <span class="o">=</span> <span class="p">[],[]</span>
		<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">):</span>
			<span class="n">pp0</span><span class="p">,</span><span class="n">pp1</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_prob_coi_single_node</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coir</span><span class="p">)</span>
			<span class="n">p0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">pp0</span>  <span class="p">)</span>
			<span class="n">p1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">pp1</span>  <span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">p1d_coi0</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">p1d_coi1</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>

	<span class="c1">#----------------------------------------</span>
	<span class="c1"># POI-level calculations</span>
	<span class="c1">#----------------------------------------</span>
	<span class="k">def</span> <span class="nf">_calculate_prob_continua_poi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1"># P(H0 reject) at individual nodes:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">p1d_poi0</span>    <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z0</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">zstar</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">p1d_poi1</span>    <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z1</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">zstar</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">_calculate_prob_poi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1">### P(H0 reject) at points of interest:</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">poi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">p_poi0</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1d_poi0</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">poi</span><span class="p">]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">p_poi1</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1d_poi1</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">poi</span><span class="p">]</span>

	<span class="c1">#----------------------------------------</span>
	<span class="c1"># Omnibus-level calculations</span>
	<span class="c1">#----------------------------------------</span>
	<span class="k">def</span> <span class="nf">_calculate_critical_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">i</span>                <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="o">.</span><span class="n">value</span>
		<span class="n">perc</span>             <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
		<span class="c1">### compute distributions of the maximum test statistic:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">z0</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z0</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">z1</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z1</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="c1">### compute maximum cluster extent distribution:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">zstar</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z0</span><span class="p">,</span> <span class="n">perc</span><span class="p">)</span>
	
	<span class="k">def</span> <span class="nf">_calculate_prob_omnibus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">p_reject0</span>   <span class="o">=</span> <span class="n">_pkmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zstar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">p_reject1</span>   <span class="o">=</span> <span class="n">_pkmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zstar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">p_reject0</span>   <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z0</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">zstar</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1">#should be alpha by definition, this is just a numerical verification</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">p_reject1</span>   <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z1</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">zstar</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

	<span class="c1">#----------------------------------------</span>
	<span class="c1"># Calculate everything</span>
	<span class="c1">#----------------------------------------</span>
	<span class="k">def</span> <span class="nf">_calculate_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_calculate_critical_threshold</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_calculate_prob_omnibus</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_calculate_prob_continua_poi</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_calculate_prob_continua_coi</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_calculate_prob_poi</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_calculate_prob_coi</span><span class="p">()</span>



<div class="viewcode-block" id="SimulationResults.plot"><a class="viewcode-back" href="../../API/results.html#power1d.results.SimulationResults.plot">[docs]</a>	<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Plot simulation results.</span>
<span class="sd">		</span>
<span class="sd">		This will plot the &quot;null&quot; and &quot;effect&quot; experiment models along</span>
<span class="sd">		with their omnibus powers and their power continua.</span>
<span class="sd">		</span>
<span class="sd">		By defintion the &quot;null&quot; experiment model will have an omnibus power</span>
<span class="sd">		of *alpha* and its power continua will be considerably smaller than</span>
<span class="sd">		*alpha*, with power decreasing as a function of continuum size.</span>
<span class="sd">		</span>
<span class="sd">		The &quot;effect&quot; experiment model will have an omnibus power that</span>
<span class="sd">		depends on the signal and noise models contained in its DataSample</span>
<span class="sd">		models.</span>
<span class="sd">		</span>
<span class="sd">		Keyword arguments:</span>
<span class="sd">		</span>
<span class="sd">		q ------ an optional array specifying continuum points (default None)</span>
<span class="sd">		</span>
<span class="sd">		</span>
<span class="sd">		Example:</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt;  Q = results.Q  #continuum size</span>
<span class="sd">		&gt;&gt;&gt;  results.plot( q=np.linspace(0, 1, Q) )</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">ndatamodels</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model0</span><span class="o">.</span><span class="n">nmodels</span>
		<span class="n">hasregressor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model1</span><span class="o">.</span><span class="n">data_models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hasregressor</span>
		<span class="k">if</span> <span class="n">ndatamodels</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasregressor</span><span class="p">:</span>
			<span class="n">_plot_results_one_datamodel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">_plot_results_multiple_datamodels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span></div>


<div class="viewcode-block" id="SimulationResults.save"><a class="viewcode-back" href="../../API/results.html#power1d.results.SimulationResults.save">[docs]</a>	<span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Save simulation results.</span>
<span class="sd">		</span>
<span class="sd">		Arguments:</span>
<span class="sd">		</span>
<span class="sd">		filename ------ full path to a file. Should have a &quot;.npz&quot; extension (numpy compressed format).  It must follow the rules of **np.savez**.</span>
<span class="sd">		</span>
<span class="sd">		Example:</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt;  results.save( &quot;/Users/username/Desktop/my_results.npz&quot; )</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">np</span><span class="o">.</span><span class="n">savez_compressed</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">Z0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Z0</span><span class="p">,</span> <span class="n">Z1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Z1</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span></div>
	
	
<div class="viewcode-block" id="SimulationResults.set_alpha"><a class="viewcode-back" href="../../API/results.html#power1d.results.SimulationResults.set_alpha">[docs]</a>	<span class="k">def</span> <span class="nf">set_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Set the Type I error rate.</span>
<span class="sd">		</span>
<span class="sd">		After calling this method all probabilities will be re-computed automatically.</span>
<span class="sd">		</span>
<span class="sd">		Arguments:</span>
<span class="sd">		</span>
<span class="sd">		alpha ------ Type I error rate (float between 0 and 1)</span>
<span class="sd">		</span>
<span class="sd">		Example:</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt;  results.set_alpha( 0.01 )</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">_msg</span> <span class="o">=</span> <span class="s1">&#39;alpha must be a scalar greater than zero and less than one.&#39;</span>
		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="n">msg</span>
		<span class="k">assert</span> <span class="p">(</span><span class="n">alpha</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">alpha</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">),</span> <span class="n">msg</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>  <span class="o">=</span> <span class="n">alpha</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_calculate_probabilities</span><span class="p">()</span></div>

<div class="viewcode-block" id="SimulationResults.set_cluster_size_threshold"><a class="viewcode-back" href="../../API/results.html#power1d.results.SimulationResults.set_cluster_size_threshold">[docs]</a>	<span class="k">def</span> <span class="nf">set_cluster_size_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Set a cluster size threshold (*k*) for null hypothesis (H0) rejection.</span>
<span class="sd">		</span>
<span class="sd">		By default *k*=1 is used, in which case only the distribution of the</span>
<span class="sd">		continuum maximum is used as the H0 rejection criterion. For *k*</span>
<span class="sd">		larger than one, the H0 rejection criterion becomes defined by the</span>
<span class="sd">		distribution of excursion set (supra-threshold cluster) geometry.</span>
<span class="sd">		In particular, all excursion set clusters with extents less than *k*</span>
<span class="sd">		are ignored both in critical threshold computations and in power</span>
<span class="sd">		computations.</span>
<span class="sd">		</span>
<span class="sd">		After calling this method all probabilities will be re-computed automatically.</span>
<span class="sd">		</span>
<span class="sd">		Arguments:</span>
<span class="sd">		</span>
<span class="sd">		k ------ Type I error rate (integer greater than 0)</span>
<span class="sd">		</span>
<span class="sd">		Example:</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt;  results.set_cluster_size_threshold( w )</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s1">&#39;cluster size threshold must be an integer.&#39;</span>
		<span class="k">assert</span> <span class="n">k</span> <span class="o">&gt;=</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;cluster size threshold must be greater than or equal to zero.&#39;</span>
		<span class="k">assert</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="s1">&#39;cluster size threshold radius must be less than the continuum length.&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">k</span>      <span class="o">=</span> <span class="n">k</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_calculate_probabilities</span><span class="p">()</span></div>
	
<div class="viewcode-block" id="SimulationResults.set_coi"><a class="viewcode-back" href="../../API/results.html#power1d.results.SimulationResults.set_coi">[docs]</a>	<span class="k">def</span> <span class="nf">set_coi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">coi</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Set centers-of-interest (COIs) to be displayed when printing.</span>
<span class="sd">		</span>
<span class="sd">		An arbibtrary number of (location, radius) pairs specifying</span>
<span class="sd">		locations of empirical interest. These COI results will be</span>
<span class="sd">		displayed when using the &quot;print&quot; command as indicated in the</span>
<span class="sd">		example below.</span>
<span class="sd">		</span>
<span class="sd">		After calling this method all relevant probabilities will be re-computed automatically.</span>
<span class="sd">		</span>
<span class="sd">		Arguments:</span>
<span class="sd">		</span>
<span class="sd">		coi ------ A sequence of integer pairs (location, radius)</span>
<span class="sd">		</span>
<span class="sd">		Example:</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt;  results.set_coi( (10,2), (50,8), (85,4) )</span>
<span class="sd">		&gt;&gt;&gt;  print(results)</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">_msg</span> <span class="o">=</span> <span class="s1">&#39;input to set_coi must be a sequence of two-tuples.&#39;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">coi</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coi</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="n">_msg</span><span class="p">))</span>
		<span class="k">assert</span> <span class="n">coi</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="n">_msg</span>
		<span class="k">assert</span> <span class="n">coi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="n">_msg</span>
		<span class="k">assert</span> <span class="n">coi</span><span class="o">.</span><span class="n">dtype</span><span class="o">==</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;input to set_coi must contain only integers&#39;</span>
		<span class="c1">### ensure that all coi centers lie in the ROI:</span>
		<span class="n">x</span><span class="p">,</span><span class="n">r</span>         <span class="o">=</span> <span class="n">coi</span><span class="o">.</span><span class="n">T</span>
		<span class="n">ind</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">xx</span><span class="p">,</span><span class="n">rr</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">r</span><span class="p">)</span> <span class="p">):</span>
			<span class="k">assert</span> <span class="n">xx</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;all centers of interest must be greater than or equal to zero&#39;</span>
			<span class="k">assert</span> <span class="n">xx</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="s1">&#39;all centers of interest must be less than or equal to the continuum size&#39;</span>
			<span class="k">assert</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">,</span> <span class="s1">&#39;all centers of interest must lie inside the specified region-of-interest.  Point </span><span class="si">%d</span><span class="s1"> is outside the ROI.&#39;</span> <span class="o">%</span><span class="n">xx</span>
			<span class="k">assert</span> <span class="n">xx</span><span class="o">-</span><span class="n">rr</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">,</span> <span class="s1">&#39;no center of interest can extend beyond the specified region-of-interest.  Point </span><span class="si">%d</span><span class="s1"> minus radius </span><span class="si">%d</span><span class="s1"> extends outside the ROI.&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">rr</span><span class="p">)</span>
			<span class="k">assert</span> <span class="n">xx</span><span class="o">+</span><span class="n">rr</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">,</span> <span class="s1">&#39;no center of interest can extend beyond the specified region-of-interest.  Point </span><span class="si">%d</span><span class="s1"> plus radius </span><span class="si">%d</span><span class="s1"> extends outside the ROI.&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">rr</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">coi</span>    <span class="o">=</span> <span class="n">coi</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_calculate_prob_coi</span><span class="p">()</span></div>

<div class="viewcode-block" id="SimulationResults.set_coi_radius"><a class="viewcode-back" href="../../API/results.html#power1d.results.SimulationResults.set_coi_radius">[docs]</a>	<span class="k">def</span> <span class="nf">set_coi_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Set centers-of-interest (COI) radius for the COI continuum results.</span>
<span class="sd">		</span>
<span class="sd">		When using the &quot;plot&quot; method COI continuum results will be displayed</span>
<span class="sd">		by default. These indicate power associated with small regions</span>
<span class="sd">		surrounding the particular continuum point.</span>
<span class="sd">		</span>
<span class="sd">		If the continuum radius is small the COI power will generally be</span>
<span class="sd">		smaller than the omnibus power. As the COI radius increases the COI</span>
<span class="sd">		power will plateau at the omnibus power.</span>
<span class="sd">		</span>
<span class="sd">		If the continuum radius is one then the COI power continuum is</span>
<span class="sd">		equivalent to the point-of-interest (POI) power continuum.</span>
<span class="sd">		</span>
<span class="sd">		After calling this method all relevant probabilities will be re-computed automatically.</span>
<span class="sd">		</span>
<span class="sd">		Arguments:</span>
<span class="sd">		</span>
<span class="sd">		r ------ COI radius (int)</span>
<span class="sd">		</span>
<span class="sd">		Example:</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt;  results.set_coi_radius( 5 )</span>
<span class="sd">		&gt;&gt;&gt;  results.plot()</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s1">&#39;coi radius must be an integer.&#39;</span>
		<span class="k">assert</span> <span class="n">r</span> <span class="o">&gt;=</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;coi radius must be greater than or equal to zero.&#39;</span>
		<span class="k">assert</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="s1">&#39;coi radius must be less than the continuum length.&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">coir</span>    <span class="o">=</span> <span class="n">r</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_calculate_prob_continua_coi</span><span class="p">()</span></div>

<div class="viewcode-block" id="SimulationResults.set_poi"><a class="viewcode-back" href="../../API/results.html#power1d.results.SimulationResults.set_poi">[docs]</a>	<span class="k">def</span> <span class="nf">set_poi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">poi</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Set points-of-interest (POIs) to be displayed when printing.</span>
<span class="sd">		</span>
<span class="sd">		The power associated with an arbibtrary number of continuum POIs </span>
<span class="sd">		will be displayed when using the &quot;print&quot; command as indicated</span>
<span class="sd">		in the example below.</span>
<span class="sd">		</span>
<span class="sd">		After calling this method all relevant probabilities will be re-computed automatically.</span>
<span class="sd">		</span>
<span class="sd">		Arguments:</span>
<span class="sd">		</span>
<span class="sd">		poi ------ A sequence of integers</span>
<span class="sd">		</span>
<span class="sd">		Example:</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt;  results.set_coi( (10,2), (50,8), (85,4) )</span>
<span class="sd">		&gt;&gt;&gt;  print(results)</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">poi</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">poi</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;input to set_poi must be a sequence of integers&#39;</span><span class="p">))</span>
		<span class="n">ind</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poi</span><span class="p">):</span>
			<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s1">&#39;all points of interest must be integers.  Input #</span><span class="si">%d</span><span class="s1"> is not an integer.&#39;</span> <span class="o">%</span><span class="n">i</span>
			<span class="k">assert</span> <span class="n">x</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;all points of interest must be greater than or equal to zero&#39;</span>
			<span class="k">assert</span> <span class="n">x</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="s1">&#39;all points of interest must be less than or equal to the continuum size&#39;</span>
			<span class="k">assert</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">,</span> <span class="s1">&#39;all points of interest must lie inside the specified region-of-interest.  Point </span><span class="si">%d</span><span class="s1"> is outside the ROI.&#39;</span> <span class="o">%</span><span class="n">x</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_calculate_prob_poi</span><span class="p">()</span></div>

<div class="viewcode-block" id="SimulationResults.set_roi"><a class="viewcode-back" href="../../API/results.html#power1d.results.SimulationResults.set_roi">[docs]</a>	<span class="k">def</span> <span class="nf">set_roi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">roi</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Set region of interest (ROI).</span>
<span class="sd">		</span>
<span class="sd">		An ROI constrains the continuum extent of the null hypothesis (H0).</span>
<span class="sd">		By default the entire continuum is considered to be the ROI of</span>
<span class="sd">		interest. Single or multiple ROIs can be specified as indicated</span>
<span class="sd">		below, and this will cause all data outside the ROIs to be</span>
<span class="sd">		ignored.</span>
<span class="sd">		</span>
<span class="sd">		Setting the ROI to a single point will yield results associated</span>
<span class="sd">		with typical power calculations. That is, a single continuum point</span>
<span class="sd">		behaves the same as a single scalar dependent variable.</span>
<span class="sd">		</span>
<span class="sd">		After calling this method all probabilities will be re-computed automatically.</span>
<span class="sd">		</span>
<span class="sd">		Arguments:</span>
<span class="sd">		</span>
<span class="sd">		roi ------ a boolean array or a **power1d.continua.RegionOfInterest** object</span>
<span class="sd">		</span>
<span class="sd">		Example:</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt;  Q = results.Q  #continuum size</span>
<span class="sd">		&gt;&gt;&gt;  roi = np.array( [False]*Q )  #boolean array</span>
<span class="sd">		&gt;&gt;&gt;  roi[50:80] = True</span>
<span class="sd">		&gt;&gt;&gt;  results.set_roi( roi )</span>
<span class="sd">		&gt;&gt;&gt;  print(results)</span>
<span class="sd">		&gt;&gt;&gt;  results.plot()</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">roi</span>  <span class="o">=</span> <span class="n">RegionOfInterest</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">roi</span>  <span class="o">=</span> <span class="n">RegionOfInterest</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input &quot;roi&quot; must be a viable input for power1d.roi.RegionOfInterest&#39;</span><span class="p">)</span>
		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">roi</span><span class="p">,</span> <span class="n">RegionOfInterest</span><span class="p">),</span> <span class="s1">&#39;Input to set_roi must be an instance of power1d.RegionOfInterest.&#39;</span>
		<span class="k">assert</span> <span class="n">roi</span><span class="o">.</span><span class="n">Q</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="s1">&#39;ROI and data continuum sizes must be the same. ROI size = </span><span class="si">%d</span><span class="s1">, data size = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">roi</span>   <span class="o">=</span> <span class="n">roi</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_calculate_probabilities</span><span class="p">()</span></div>
		
		
<div class="viewcode-block" id="SimulationResults.sf"><a class="viewcode-back" href="../../API/results.html#power1d.results.SimulationResults.sf">[docs]</a>	<span class="k">def</span> <span class="nf">sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Survival function.</span>
<span class="sd">		</span>
<span class="sd">		The probability that the &quot;effect&quot; distribution exceeds an arbitrary</span>
<span class="sd">		threshold *u*.</span>
<span class="sd">		</span>
<span class="sd">		Arguments:</span>
<span class="sd">		</span>
<span class="sd">		u ------ threshold (float)</span>
<span class="sd">		</span>
<span class="sd">		Example:</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt;  print(  results.sf( 3.0 )  )</span>
<span class="sd">		&gt;&gt;&gt;</span>
<span class="sd">		&gt;&gt;&gt;  u = [0, 1, 2, 3, 4, 5]</span>
<span class="sd">		&gt;&gt;&gt;  p = [results.sf(uu) for uu in u]</span>
<span class="sd">		&gt;&gt;&gt;  print( p )</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z1</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span></div></div>






</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">power1d 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Todd Pataky.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.6.
    </div>
  </body>
</html>